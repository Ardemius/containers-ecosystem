= Histoire de la conteneurisation : pr√©paration de la prise de parole
Thomas SCHWENDER <icon:github[] https://github.com/Ardemius/[GitHub] / icon:twitter[role="aqua"] https://twitter.com/thomasschwender[@thomasschwender]>
// Handling GitHub admonition blocks icons
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
:imagesdir: ./images
:resourcesdir: ./resources
:source-highlighter: highlightjs
:highlightjs-languages: asciidoc
// We must enable experimental attribute to display Keyboard, button, and menu macros
:experimental:
// Next 2 ones are to handle line breaks in some particular elements (list, footnotes, etc.)
:lb: pass:[<br> +]
:sb: pass:[<br>]
// check https://github.com/Ardemius/personal-wiki/wiki/AsciiDoctor-tips for tips on table of content in GitHub
:toc: macro
:toclevels: 4
// To number the sections of the table of contents
//:sectnums:
// Add an anchor with hyperlink before the section title
:sectanchors:
// To turn off figure caption labels and numbers
:figure-caption!:
// Same for examples
//:example-caption!:
// To turn off ALL captions
// :caption:

// toc::[]

== SLIDE : TITRE

Wahou, cela fait vraiment plaisir de voir que vous √™tes aussi nombreux √† avoir √©t√© int√©ress√©s par ce sujet üëç 
Quand j'ai vu le nombre de like sur l'application, je vous garantis que cela fait chaud au coeur.

== SLIDE : Je vous parle d'un temps que les moins de 20 ans, NON de 40 ans !, ne peuvent pas conna√Ætre

Donc bonjour √† toutes et √† tous,

Et bienvenue √† ce talk o√π il va √™tre question de *conteneurisation*, et plus particuli√®rement de *l'histoire et l'√©volution de cette derni√®re depuis ses d√©buts*, il y a bieeennnnnnn longtemps, jusqu'√† aujourd'hui.

== SLIDE : PRESENTATION

Alors, je me pr√©sente, je m'appelle Thomas SCHWENDER, je suis architecte au sein de la soci√©t√© *Softeam*, qui est depuis 2020 une entit√© du groupe *Docaposte*, qui lui-m√™me appartient au groupe *La Poste* que tout le monde conna√Æt bien. +
Les 2 soci√©t√©s ont cette ann√©e *un stand sur le salon*, n'h√©sitez pas √† y faire un tour pour d√©couvrir nos projets. On ne s'en doute peut-√™tre pas de prime abord, mais de la *confiance num√©rique* √† l'*eSant√©* en passant par l'*IA*, on travaille vraiment sur des *enjeux de soci√©t√© tr√®s actuels*.

Depuis 2 ans, je mets √©galement √† jour un *article sur le blog de Devoxx France* qui explique *comment tirer profit au maximum de sa pr√©sence √† un salon comme Devoxx*.
Entre autres conseils pratiques, j'y explique comment *cr√©er sa propre base de connaissances* pour persister sa veille techno et la rendre facilement accessible et exploitable tout au long de sa carri√®re.

D'ailleurs, sur ce m√™me th√®me, je vous conseille vraiment d'aller *assister vendredi √† la conf√©rence "Apprendre en continu avec sa veille technologique"* de Fabien Hiegel et David Franck.
Ils ont d√©j√† donn√© ce talk au dernier DevFest Nantes, je l'ai trouv√© top, et ils vont plus loin que moi sur ce concept de base de connaissance ou de "2nd cerveau" comme ils l'appellent.
Vraiment, pour vous, la veille que vous faites en salon, ou par d'autres moyens, faites en sorte qu'elle vous serve le plus longtemps possible, et qu'elle ne soit pas oubli√©e dans quelques jours ou semaines.

Sur ce revenons au *sujet qui va nous int√©resser jusqu'√† la fin du talk*, √† savoir *comprendre par quoi l'informatique est pass√©e* pour arriver jusqu'aux conteneurs tels qu'on les conna√Æt aujourd'hui, et *pourquoi* √ßa s'est pass√© comme √ßa.
L'id√©e de ce talk est que, pour mieux comprendre le pr√©sent, et pouvoir envisager sereinement le futur, il est bon de conna√Ætre le pass√© et savoir d'o√π l'on vient.

-> C'est √©galement l'id√©e d'une citation de Nicolas Machiavel (Philosophe (1469 - 1527)) : 
Pour pr√©voir l'avenir, il faut conna√Ætre le pass√©, car les √©v√©nements de ce monde ont en tout temps des liens aux temps qui les ont pr√©c√©d√©s. Cr√©√©s par les hommes anim√©s des m√™mes passions, ces √©v√©nements doivent n√©cessairement avoir les m√™mes r√©sultats.

== SLIDE : DISCLAIMER

Petit disclaimer avant d'aller plus loin : on ne va *PAS expliquer comment se servir de Docker, Kubernetes ou WebAssembly* durant ce talk.
Le but est vraiment de se concentrer sur *l'encha√Ænement des progr√®s technologiques* au cours des ann√©es.

Autre point : n'allez surtout pas croire que je suis un sp√©cialiste de chaque technologie pr√©sent√©e.
Il y aura donc des slides verbeux, car je ne suis tout simplement pas capable de tout retenir.

== SLIDE : PLAN

Donc en termes de plan, les choses sont simples : dans ce talk, il sera question de dates. +
Et dans l'histoire de la conteneurisation depuis les ann√©es 70s, des dates il y en a eu beaucoup... VRAIMENT beaucoup...

En fait, des dates, il y en a trop, on ne pourra pas entrer dans les d√©tails de chacune, on va *se concentrer sur les plus importantes*.

PAR CONTRE, en *fin de talk*, je vous mettrai √† disposition la *version compl√®te de la chronologie* sur laquelle j'ai travaill√© üòâ 

== SLIDE : DEFINTION : CONTENEUR

Avant de d√©buter notre voyage dans le temps, il est important de revoir 2 concepts qui reviendront tout au long du talk.

Commen√ßons par le 1er : mais au fait, *qu'est-ce donc qu'un conteneur ?*
Aussi surprenant que cela puisse para√Ætre, il n'y a pas de r√©elle d√©finition "officielle" de ce qu'est un "container"

Mais ce sur quoi tout le monde s'accorde est qu'√† minima un conteneur est un *groupe de process isol√©s du reste du syst√®me (du host) par certains moyens techniques*.
Dans la suite du talk, nous allons justement pr√©ciser de quels moyens il est question.

== SLIDE : DEFINTION : RUNTIME

L'autre concept dont il est question est celui de *runtime*, ou environnement d'ex√©cution.

Alors, runtime, runtime environment, RTE, environnement d'ex√©cution, toutes ces expressions sont *synonymes*.

Et la d√©finition que l'on peut en donner est qu'un runtime est la pile logicielle offrant les services n√©cessaires √† l'ex√©cution d'applications, et *UNIQUEMENT l‚Äôex√©cution*, PAS la compilation, et cela, *ind√©pendamment du syst√®me d'exploitation*.

Le runtime met √† disposition un certain nombre de fonctions de base au service de la *m√©moire*, du *r√©seau* ou du *mat√©riel* ET *ex√©cute ces fonctions √† la place de l‚Äôapplication*, ind√©pendamment du syst√®me d‚Äôexploitation. C'est en fait le runtime qui fait donc le lien entre l‚Äôapplication et le syst√®me d‚Äôexploitation.

== SLIDE - RUNTIME : JRE vs JDK vs JVM

Un exemple bien connu de runtime est tout simplement le *JRE de Java*. +
Ce dernier englobe la *JVM* et la *JCL*, la *Java Class Library*, un ensemble de classes procurant √† la JVM tout ce dont elle a besoin pour ex√©cuter une application Java d'un point de vue *m√©moire*, *r√©seau*, syst√®me de *fichiers*, sp√©cificit√©s *mat√©rielles*.

On peut √©galement donner d'autres exemples : 

* *Node.js* : qui est un environnement d'ex√©cution permettant d'ex√©cuter du *code Javascript* c√¥t√© serveur.
* On y pense moins, mais il y a √©galement le bon vieux *Cygwin* qui est un environnement d‚Äôex√©cution permettant aux *applications Linux* de fonctionner sur d'autres OS comme Windows ou macOS.

== SLIDE - RUNTIME : comparaison JRE vs Node.js

D'ailleurs si on compare le JRE √† Node.js, on voit tout de suite les similitudes : 

    * En lieu et place de la JVM, Node.js utilise *V8*, le *moteur Javascript de Google*, initialement d√©velopp√© pour Chrome.
    * Et les classes de la JCL sont remplac√©es par des *modules √©quivalents* c√¥t√© Node.js

== SLIDE 9 - 1970s

Bon, nous sommes maintenant par√©s pour notre voyage dans le temps, et pour d√©buter ce dernier, nous allons remonter jusqu'aux ann√©es 1970 !

== SLIDE - 1972

* L‚Äôid√©e originale de conteneur a germ√© dans les ann√©es 70s sur les syst√®mes *Unix*, lorsqu'on a eu besoin de mieux *isoler le code applicatif*.
    
* A cette √©poque les *ordinateurs* √©taient tr√®s *chers* et donc tr√®s *rares*, aussi fallait-il pouvoir *les exploiter au maximum*. +
On a donc cherch√© √† *partager leurs ressources entre diff√©rents utilisateurs*, sans que le travail de l'un n'ait d'impact sur celui de l'autre.
    
* L'autre probl√©matique concernait *les tests*. On l'a dit les ordinateurs √©taient tr√®s chers, on ne disposait donc souvent que d'*une seule machine* qui devait faire tourner ET les *syst√®mes de production* ET permettre aux d√©veloppeurs de *tester leurs applications*. +
Il fallait donc que ces tests puissent se faire sans impacter les traitements de PROD, aussi c'est √† cette √©poque que sont apparus *les 1eres "sandboxes"*, des environnements isol√©s permettant de tester applications, services et process ; en d'autres termes : les 1ers conteneurs.

Concernant la photo, il s'agit de *Ken Thompson* et *Dennis Ritchie* √† c√¥t√© d'un PDP-11 chez Bell Labs, vers 1972. +
Pour rappel, ce sont vraiment 2 des plus grands pionniers de l'informatique ; les cr√©ateurs d'Unix et du langage C. +
Ken Thompson est √©galement le cr√©ateur du premier shell Unix en 1971, sur la 1ere version d'Unix. +

Personnellement, c'est une photo qui me touche, c'est l'alter ego informatique de "Trois hommes dans un salon" avec Brel, Brassens et Ferr√© en 1969, c'est un moment d'histoire...

== SlIDE - 1979 chroot

Dans cet exemple, "ls" ne peut pas acc√©der au r√©pertoire racine initial, il est restreint √† l'environnement isol√© qu'on lui a donn√©.

Attention, chroot a plusieurs *probl√®mes de s√©curit√©* connus. +
En l'occurrence, il est *facile de "s'√©chapper de l'environnement isol√©"*

Raison pour laquelle les outils de conteneurisation actuels, comme Docker, utilisent √† la place *pivot_root* pour lequel s'est bien moins facile.

== SLIDE - 2000s

Et l√†, gros gap, on va directement sauter aux ann√©es 2000, o√π vont appara√Ætre les 1eres r√©elles impl√©mentations d'outils de conteneurisation.

== SLIDE - FreeBSD Jails

== SLIDE - Linux VServer

Impossible de trouver un sch√©ma d'architecture global de Linux VServer.
J'ai donc mis le sch√©ma d'architecture du VServer Control Daemon, mais cela n'apporte vraiment rien dans notre cas.

Ce projet permet d'*ex√©cuter une ou plusieurs distributions sur une distribution* (distribution = syst√®me d'exploitation sans le noyau)

Patcher le kernel Linux : une *charge en plus* pour les distributeurs et les sysadmin.

== SLIDE - 2002 - 1er LINUX NAMESPACE

== SLIDE - Julia EVANS "HOW TO MAKE A NAMESPACE"

J'en reparlerai en fin de talk, mais voici une planche cr√©√©e par Julia EVANS pour vulgariser la cr√©ation d'un namespace.
Je voulais vous la montrer car je trouve cela super bien fait, mais on ne va pas tout regarder.
Jetez juste un oeil au nom de la commande (unshare) permettant la cr√©ation d'un namespace : "tu ne partageras point"

== SLIDE - 2002 - MOUNT NAMESPACES

Les mount namespaces sont utilis√©s pour isoler les points de montage du syst√®me de fichiers entre les diff√©rents processus, ce qui permet √† chaque processus de disposer de son propre point de montage racine. Cela permet d'isoler les syst√®mes de fichiers et les processus entre eux, ce qui est essentiel pour la conteneurisation.

== SLIDE - 2003 - BORG 

Borg est bien toujours utilis√© aujourd'hui (2022) dans les datacenters de Google, et PAS Kubernetes, qui est utilis√© pour des services Cloud et est surtout destin√© √† des utilisateurs externes.

== SLIDE - 2004 - Solaris Containers (Zones Solaris)

== SLIDE - 2005 - OpenVZ

https://www.youtube.com/watch?v=sK5i-N34im8[cgroups, namespaces, and beyond: what are containers made from?] de J√©r√¥me PETAZZONI

Container runtimes qui ne sont PAS bas√©s sur les namespaces et les cgroups (fonctionnalit√©s du noyau Linux) : 

    * *Jails*
    * *Solaris Containers*
    * *OpenVZ* 

-> Logique, ces 3 OS, m√™me s'ils sont de type Unix, utilisent des noyaux diff√©rents, et les namespaces et les cgroups sont des fonctionnalit√©s du noyau LINUX.

== SLIDE - Warden

Cloud Foundry a plus tard remplac√© les Containers Linux par leur propre impl√©mentation, utilisant toujours les cgroups et les namespaces

Le plus important pour Warden √©tait de rendre possible la gestion d‚Äôenvironnements isol√©s par un moyen simple : une API.

== SLIDE cgroups + namespaces -> cr√©ation de conteneurs

    * *pivot_root* : set a process's root directory to a directory with the contents of the container image
        ** difference between pivot_root and *chroot* : chroot is easy to escape from if you're root and pivot root isn't +
        -> so containers use pivot_root instead of chroot
        ** l'h√©ritier de chroot en version plus s√©curis√©e
    * *cgroups* : limit memory / CPU usage for a group of processes
        ** limiter COMBIEN on peut utiliser (m√©moire, CPU)
    * *namespaces* : allow processes to have their own network / PIDs / users / hostname / mounts / and more !
        ** limiter ce que l'on peut voir

    * *seccomp-bpf* : security: prevent dangerous system calls
        ** seccomp means "secure computing"
        ** bpf, pour Berkeley Packet Filter, est une extension de seccomp
        ** vise √† √©viter les appels syst√®me dangereux

    * *capabilities* : security: avoid giving root access
        ** √©vite de donner les droits root
        ** Capabilities allow to reduce the privileges of an active process

Rappel : *System call* : a request for the operating system to do something on behalf of the user's program. The system calls are functions used in the kernel itself. +
Un appel syst√®me permet au programme utilisateur d'acc√©der aux fonctionnalit√©s du noyau telles que la gestion des fichiers, des processus et des p√©riph√©riques.

== SLIDE exemple de Julia Evans de cr√©ation de conteneur √† la main



== SLIDE - DOCKER 1ere release

* Libcontainer √©tait une biblioth√®que open source d√©velopp√©e par Docker pour fournir une interface standardis√©e pour les fonctionnalit√©s de conteneurisation du noyau Linux.
* Libcontainer a permis √† Docker de devenir ind√©pendant de la biblioth√®que LXC et de fournir une interface *plus flexible* et plus s√ªre pour la *cr√©ation*, la *gestion* et l'*orchestration* de conteneurs.
* *libcontainer* a √©t√© la base de *runc*, son anc√™tre (runc tout de suite donn√© √† l'OCI √† sa cr√©ation)

* *LXC* (Linux Containers) : easy for sysadmins / OPS, hard for devs (requires significant elbow grease)
* Solomon : on avait d√©j√† les Linux Containers (LXC) avant, mais ce type de Operating System (OS) Containers n'est pas des plus simples √† utiliser. Ces derniers sont plut√¥t √† destination des sysadmin, pas des √©quipes qui "ship"

== SLIDE - RAISON D'ETRE DOCKER, POURQUOI ?

* Donc, pour r√©sumer, on a fait Docker dans le but de *shipper*. +
Il fallait donc que Docker ne soit pas "trop inf√¢me" √† utiliser.
    ** on avait d√©j√† les Linux Containers (LXC) avant, mais ce type de Operating System (OS) Containers n'est pas des plus simples √† utiliser. Ces derniers sont plut√¥t √† destination des sysadmin, pas des √©quipes qui "ship"

* Que faisait Dotcloud √† la base ?

== SLIDE - PROBLEME DE SECURITE

* "*Concern and hesitation* arose in the IT community regarding the *security of a shared OS kernel*" (https://searchitoperations.techtarget.com/feature/Dive-into-the-decades-long-history-of-container-technology)

* parler du grand probl√®me de Docker, le "monolith daemon that required root access for everything" +
Ce qui a conduit √† l'√©mergence des daemonless et autre rootless comme Podman et Buildah

* https://www.techtarget.com/searchitoperations/feature/Dive-into-the-decades-long-history-of-container-technology +
"Sysdig's "2022 Cloud-Native Security and Usage Report" found that 75% of respondents were running containers with high or critical vulnerabilities, and *76% had containers running as root*, playing a dangerous game with IT ecosystem safety."
    ** une partie des r√©sultats de l'√©tude est disponible ici : https://sysdig.com/blog/2022-cloud-native-security-usage-report/
        *** chercher Container Security le chiffre de 76% pr√©c√©dent qui nous int√©resse

== SLIDE DOCKER ROOT PLEASE !

Y a-t-il des OPS dans la salle ?
Y a-t-il des OPS qui ont v√©cu l'arriv√©e de Docker vers 2013 √† 2015 ?
Si oui, pardon... Souvenir douloureux...

DOCKER ROOT PLEASE ! (2015)

* notes de Daniel sur l'exploit : https://github.com/VonC/blog/blob/201711_docker/PITCHME.md
* Explication de l'exploit : https://fosterelli.co/privilege-escalation-via-docker (2015/04/22)

* https://sysdig.com/blog/2022-cloud-native-security-usage-report/ : pour les 76% de containers en root toujours en 2022


== SLIDE WASM

* Au final : donner l'exemple de Wordpress qui tourne dans le browser : https://wordpress.wasmlabs.dev/

== SLIDE XXX - RESSOURCES et REMERCIEMENTS

Un immense merci √† tous les auteur(e)s des articles de blog, ebooks et vid√©os que j'ai lus et vues pour pr√©parer ce sujet. +

J'ai consult√© des dizaines et des dizaines de publications, je ne peux pas nommer toutes les personnes √† remercier, mais je vous garantis que le coeur y est.

Remerciements particuliers √† *Julia Evans* (@b0rk), dont je trouve le travail fantastique üëç 
Pour celles et ceux qui ne la connaissent pas, Julia vulgarise des concepts compliqu√©s en BD.
C'est concis et limpide, je ne saurais que trop vous conseiller d'aller jeter un oeil √† son travail.
Elle publie r√©guli√®rement sur Twitter et pour la soutenir vous pouvez √©galement acheter ses "zines" pour quelques euros sur son site https://wizardzines.com/
(Et dans le cas de ce talk, tout particuli√®rement le zine *"How containers work"*)

== SLIDE FIN

Voil√†, notre voyage dans le temps est termin√©.

Je vous remercie et j'esp√®re que vous avez pu d√©couvrir des choses que vous ne saviez pas sur l'histoire de la conteneurisation depuis ses lointains d√©buts jusqu'√† aujourd'hui.
