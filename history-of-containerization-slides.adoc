= L'√©volution de la conteneurisation, de 1979 √† aujourd'hui
// classic AsciiDoctor attributes
:icons: font
:imagesdir: images
// Activate syntax highlighting with highlight.js
:source-highlighter: highlightjs
// We must enable experimental attribute to display Keyboard, button, and menu macros
:experimental:
:lb: pass:[<br> +]
// reveal.js attributes
:customcss: styles/myCustomCSS.css
:revealjs_theme: white
// To turn off figure caption labels and numbers
//:figure-caption!:
// Same for examples
//:example-caption!:
// To turn off ALL captions (see https://github.com/asciidoctor/asciidoctor/issues/2804)
:caption:

Thomas SCHWENDER

icon:github[] https://github.com/Ardemius/[Ardemius] / icon:twitter[role="blue"] https://twitter.com/thomasschwender[@thomasschwender] +
image:StarTECH-logo.png[Logo StarTECH]
//image:softeam-docaposte-logo.png[Logo Softeam Docaposte,200]
image:Softeam-software-crafter-logo.png[Logo Crafter,200,200]

== Disclaimer

Ce talk n'a *PAS* vocation √† expliquer les commandes Docker, Kubernetes ou celles d'un quelconque container runtime üôÇ 

[NOTE.speaker]
--
Rappel de l'abstract :

La plupart d'entre nous ont d√©couvert le concept de conteneur en 2013 avec l'arriv√©e de Docker. +
Aujourd'hui, avec l'av√®nement du Cloud et de Kubernetes, les conteneurs sont partout autour de nous.

Toutefois, l'histoire de la conteneurisation reste globalement m√©connue. +
Qui pour se souvenir que tout a finalement commenc√© en 1979 avec l'apparition de chroot, qui marqua le d√©but de l'isolation des processus ? +
Qu'il a fallu attendre d'avoir les cgroups (2008), puis plus tard les user namespaces (2013) pour qu'enfin Docker puisse voir le jour ? +
Que la g√©n√©ralisation des containers, cons√©quence de l'adoption de Kubernetes par tous les Cloud providers (2018), entra√Æna l'apparition des sandbox runtimes et des daemonless runtimes ?

Au cours de ce talk, nous allons d√©tailler les grandes √©tapes qui ont marqu√© l'histoire de la conteneurisation, et expliquer POURQUOI elles ont eu lieu. +
L'objectif est qu'en sortant, vous ayez compris quelle orientation a suivi la conteneurisation depuis toutes ces ann√©es, et ce vers quoi nous allons.
--

== Mais c'est quoi un conteneur aujourd'hui ?

La m√™me chose qu'hier ! üòâ +
Tout simplement un *groupe de processus isol√©s les uns des autres* par un certain moyen.

[NOTE.speaker]
--
On commence par un rappel simple
--

[.columns.fontFor2ColLayout]
== Les ann√©es 70s, les pr√©mices de la conteneurisation

[.column.has-text-justified]
--
L'id√©e originale de conteneur a germ√© dans les ann√©es 70s sur les syst√®mes Unix, quand l'on a eu besoin de *mieux isoler le code applicatif*.

A cette √©poque les ordinateurs √©taient tr√®s chers et donc tr√®s *rares*, il fallait donc pouvoir les *exploiter au maximum*.
--

[.column.has-text-justified]
--
.Ken Thompson et Dennis Ritchie, inventeurs d'UNIX, devant un PDP-11 vers 1972
image::1972_Unix-Ken-Thompson-Dennis-Ritchie-PDP-11.jpg[]
--

[NOTE.speaker]
--
Concernant l'image, il s'agit d'un PDP-11 avec Ken Thompson et Dennis Ritchie √† c√¥t√© de lui. +
Pour rappel, ce sont les cr√©ateurs d'Unix et du langage C, et Ken Thompson est √©galement le cr√©ateur du premier shell Unix en 1971, sur la 1ere version d'Unix. +
Cette photo, c'est l'alter ego informatique de "Trois hommes dans un salon" avec Brassens, Brel et Ferr√© en 1969, c'est un moment d'histoire...
--

[.columns.fontFor2ColLayout]
== 1979 - *grande √©tape* : `chroot`

[.column.has-text-justified]
--
L'appel syst√®me `chroot` a √©t√© cr√©√© en 1979, pendant le d√©veloppement de la *version 7 d'Unix*.

`chroot` permet de *changer le r√©pertoire racine d'un processus et de ses enfants*.

Cela a marqu√© le d√©but de l'*isolation des processus*, en restreignant l'acc√®s d'une application √† une arborescence de fichiers donn√©es.
--

[.column.has-text-justified]
--
image::chroot-example.png[]

La s√©curit√© s'en voit renforc√©e, l'environnement isol√© ne permettant th√©oriquement pas √† une attaque de "sortir" sur un syst√®me ext√©rieur.
--

[NOTE.speaker]
--
*System call* : a request for the operating system to do something on behalf of the user's program. The system calls are functions used in the kernel itself.

"Chroot marked the beginning of container-style process isolation by restricting an application's file access to a specific directory "the root" and its children. A key benefit of chroot separation was improved system security, such that an *isolated environment could not compromise external systems* if an internal vulnerability was exploited."

Chroot was added to BSD in 1982.
--

[.columns.fontFor2ColLayout]
== 2000/03 : FreeBSD `Jails`

[.column.has-text-justified]
--
*Jails* permet de partitionner un syst√®me FreeBSD en *sous-syst√®mes ind√©pendants*, appel√©s _"jails"_, avec la possibilit√© d'assigner √† chacun d'eux une adresse IP sp√©cifique.
--

[.column]
--
image::FreeBSD-jails-example.png[width=500]
--

[NOTE.speaker]
--
Jails were first introduced in FreeBSD OS version 4.0, that was released on *March 14, 2000*
--

[.columns.fontFor2ColLayout]
== 2001 : Linux `VServer`

[.column.has-text-justified]
--
Comme FreeBSD Jails, Linux VServer est un *m√©canisme de "prison"*.

Il permet de *partitionner des ressources* (syst√®mes de fichiers, adresses r√©seau, m√©moire) au sein de l'OS, via l'ajout de capacit√©s de virtualisation de l'OS au noyau Linux.
--

[.column.has-text-justified.is-two-fifth]
--
image::Linux-VServer-logo.png[width=300]

Son principal inconv√©nient √©tait qu'il imposait de *patcher le noyau Linux*.
--

[NOTE.speaker]
--
Jacques G√©linas created the VServer project, which according to the 0.0 version‚Äôs change log allowed "running several general purpose Linux server on a single box with a high degree of Independence and security."

The Linux-VServer solution was the *first effort on Linux* to "separate the user-space environment into distinct units (Virtual Private Servers) in such a way that each VPS looks and feels like a real server to the processes contained within." +
Linux-VServer is a virtual private server implementation that was created by *adding operating system-level virtualization capabilities to the Linux kernel*. +
Ce projet permet d'ex√©cuter un ou plusieurs environnements d'exploitation (syst√®mes d'exploitation sans le noyau) ; autrement dit, il *permet d'ex√©cuter une ou plusieurs distributions sur une distribution*.

Patcher le kernel Linux : une *charge en plus* pour les distributeurs et les sysadmin.

Last stable patch was released in 2006
--

[.columns.fontFor2ColLayout.is-vcentered]
== 2002/08 : 1ers Linux namespaces

[.column.has-text-justified]
--
Les `namespaces` sont une *fonctionnalit√© du noyau Linux* permettant √† vos processus d'√™tre s√©par√©s des autres processus tournant sur l'OS.

Ils permettent aux processus de disposer chacun de leurs *propres ressources* : r√©seau, PID, utilisateurs, hostname, mounts, etc.

Les namespaces *"limitent ce que l'on peut voir"*
--

[.column.has-text-justified]
--
image::linux-namespace-schema.png[]
--

[NOTE.speaker]
--
Namespaces can be created using the `unshare` program.
--

=== !

.Julia Evans zine "How Containers work!", focus on namespaces
image::julia-evans_how-containers-work_12_how-to-make-a-namespace.jpg[width=850]

[.columns.fontFor2ColLayout.is-vcentered]
=== mount namespaces

[.column.has-text-justified]
--
Le 1er type de namespaces √† avoir √©t√© ajout√© au noyau Linux, en version 2.4.19, est les *mount namespaces* le 2002/08/03.
--

[.column]
--
.J√©r√¥me Petazzoni (Docker), DockerCon 2015
image::mount-namespaces-description.jpg[]
--

[.columns.fontFor2ColLayout.is-vcentered]
== 2003 : Google pr√©sente `Borg`

[.column.has-text-justified]
--
Borg √©tait l'*orchestrateur de conteneurs* (container cluster management system) utilis√© en interne par Google.

Il √©tait bas√© sur les *m√©canismes d'isolation d√©j√† pr√©sents sur Linux* et pouvait ex√©cuter des milliers de jobs, en provenance de milliers d'applications, au travers d'un grand nombre de clusters chacun compos√© de dizaines de milliers de machines...
--

[.column]
--
image::borg-high-level-architecture.png[]
--

[.columns.fontFor2ColLayout.is-vcentered]
== 2004 : Solaris containers

[.column.has-text-justified]
--
En 2004, pour Solaris 10, √©tait publi√©e la 1ere beta publique des Solaris Containers, qui combinaient *contr√¥le des ressources du syst√®me* et *d√©finition de fronti√®res*, √† l'aide du concept de *zones*.

Ces zones agissent comme autant de *serveurs virtuels totalement isol√©s*, au sein d'une seule instance d'OS.
--

[.column]
--
image::solaris-containers-zones.jpg[]
--

[NOTE.speaker]
--
Les zones permettaient d'exploiter les fonctionnalit√©s de *snapshots* et de *clonage* du syst√®me de fichiers ZFS, cr√©√© pour Solaris 10 et au-del√†.

Les principales caract√©ristiques du syst√®me de fichier *ZFS* sont, entre autres, sa *tr√®s haute capacit√© de stockage*, et la *gestion de volume*.

Pour rappel, √† cette √©poque, Solaris √©tait la propri√©t√© de Sun Microsystems, qui a √©t√© rachet√© par Oracle en 2009.
--

== 2005 : `OpenVZ`

OpenVZ est une *technologie de virtualisation de niveau syst√®me d'exploitation* pour Linux, bas√© sur une version modifi√©e de son noyau.

Ce dernier apporte les fonctionnalit√©s de virtualisation, d'isolement, de gestion de ressources, et de checkpointing.

[NOTE.speaker]
--
*Application checkpointing* : permet de *migrer un VE d'un serveur physique √† un autre sans arr√™t/relance du VE*. +
Le VE est gel√© et son √©tat entier est sauvegard√© dans un fichier sur disque. Ce fichier peut alors √™tre transf√©r√© sur une autre machine sur laquelle le VE pourra √™tre restaur√©. Le d√©lai de migration est de quelques secondes, et ce n'est pas un temps d'arr√™t, juste un retard.
--

[.columns.fontFor2ColLayout]
=== !

[.column]
--
image::openvz-architecture.jpg[]

OpenVZ permet √† un serveur physique d'ex√©cuter de *multiples instances de syst√®mes d'exploitation isol√©s*, qualifi√©es de serveurs priv√©s virtuels (VPS) ou *environnements virtuels* (VE).
--

== 2006 : d√©but des travaux sur les *Process Containers* chez Google

Ces derniers, d√©velopp√©s par *Paul Menage* et *Rohit Seth*, seront rapidement renomm√©s en *cgroups* (*control groups*), et sont, avec les *namespaces*, les fonctionnalit√©s du noyau Linux ayant eu le plus d'importance pour le *d√©veloppement des conteneurs*.

=== ! 

Les cgroups sont une fonctionnalit√© du noyau Linux permettant de *limiter*, *quantifier* et *isoler* l'utilisation de *ressources* d'une *collection de processus* (CPU, m√©moire, r√©seau, etc.).

=== !

image::cgroups-schema.png[width=900]

=== !

Ils permettent de *regrouper des processus*, et de s'assurer que chaque groupe puisse r√©cup√©rer sa part de m√©moire, CPU, r√©seau, etc. afin qu'*aucun groupe ne puisse monopoliser certaines ressources*.

=== !

.Julia Evans zine "How Containers work!", focus on cgroups
image::julia-evans_how-containers-work_10_cgroups.jpg[]

=== !

Les *cgroups* limitent "*COMBIEN* on peut utiliser", l√† o√π les *namespaces* limitent "ce que l'on peut voir".

[NOTE.speaker]
--
la compl√©mentarit√© de ces 2 fonctionnalit√©s est bien visible
--

== 2007/10 : 1eres briques de l'impl√©mentation des `user namespaces`

*Eric Biederman* d√©veloppe ces 1eres briques qu'il ajoute √† la version 2.6.23 du noyau Linux.

[.columns.fontFor2ColLayout.is-vcentered]
=== !

[.column.has-text-justified]
--
Les *user namespaces* sont les namespaces les plus complexes et les plus importants pour le fonctionnement de la conteneurisation.

Ils permettent √† un processus d'avoir ses *propres utilisateurs*, et de disposer des *droits root dans un conteneur*, mais *PAS √† l'ext√©rieur*.
--

[.column]
--
image::user-namespaces-explanation.jpg[]
--

=== !

image::julia-evans_how-containers-work_14_user-namespaces.jpg[]

[NOTE.speaker]
--
La planche de Julia d√©crit les user namespaces quand ils marchaient parfaitement, en 2007/10 il ne s'agissait que des 1ers briques, ce n'√©tait pas encore complet.
--

== 2008/01 - *grande √©tape*

Ajout de la fonctionnalit√© des *cgroups* dans la version 2.6.24 du noyau Linux.

== 2008/08 - *grande √©tape*

Cr√©ation du projet "*Linux Containers*" (*LXC*) par des ing√©nieurs d'IBM.

[.columns.fontFor2ColLayout.is-vcentered]
=== !

[.column.has-text-justified]
--
Les Linux Containers ont √©t√© la 1ere v√©ritable impl√©mentation d'une *gestion de conteneurs pour Linux*.

Ils s'appuient sur les *cgroups* et les Linux *namespaces*, et fonctionnent sur un noyau Linux *non* patch√©.
--

[.column]
--
image::Linux-Container-Architecture.jpg[]
--

[NOTE.speaker]
--
Avec LXC, on peut vraiment commencer √† parler de *container runtimes* (c'est le d√©but).

LXC : easy for sysadmins / OPS, *hard for devs* (requires significant elbow grease)
--

[.columns.fontFor2ColLayout.is-vcentered]
== 2011 : `Warden`

[.column.has-text-justified]
--
Projet lanc√© par CloundFoundry, *Warden* s'appuyait √† la base sur LXC.

Il avait pour but de fournir moyen *simple* de *g√©rer des environnements isol√©s* (des conteneurs üòâ)

Pour se faire, il tournait comme un *daemon*, et proposait une *API de gestion de conteneurs*.
--

[.column]
--
image::warden-architecture.png[]
--

[NOTE.speaker]
--
* CloudFoundry started Warden in 2011, using *LXC in the early stages* and *later replacing it* with its own implementation. +
Warden can isolate environments on any operating system, running as a daemon and providing an API for container management. It developed a client-server model to manage a collection of containers across multiple hosts, and Warden includes a service to manage *cgroups*, *namespaces* and the *process life cycle*.

* Warden creates a root process, called "wshd" for Warden shell *daemon*, in each container.
* The Warden protocol is defined using *Google protocol buffer* definitions
--

== 2013/02 : *grande √©tape*

Ajout de la 1ere "version compl√®te" des *user namespaces* au kernel Linux 3.8

=== !

Solomon Hykes l'a affirm√© lors de son tout premier talk de pr√©sentation Docker, c'est la sortie de ces *user namespaces* "qui marchent maintenant", qui a *rendu Docker possible*.

[NOTE.speaker]
--
La 1ere version des "user namespaces qui marchent vraiment" d'apr√®s Solomon Hykes. +
Celle qui a permis la sortie de Docker tr√®s peu apr√®s. +
Voir la conf https://www.youtube.com/watch?v=3N3n9FzebAA √† 16:19
--

=== On a maintenant tout pour cr√©er des conteneurs ! üôÇ 

Avec les *cgroups*, les *namespaces*, ainsi que quelques autres fonctionnalit√©s du noyau Linux (`pivot_root`, `seccomp-bpf`, `capabilities`), nous avons tout pour cr√©er des conteneurs, y compris "√† la main"

=== ! 

image::julia-evans_how-containers-work_3_containers-arent-magic.jpg[]

[NOTE.speaker]
--
Autres Linux Kernel features : 

    * *pivot_root* : set a process's root directory to a directory with the contents of the container image
        ** difference between pivot_root and *chroot* : chroot is easy to escape from if you're root and pivot root isn't +
        -> so containers use pivot_root instead of chroot
    * *cgroups* : limit memory / CPU usage for a group of processes
    * *namespaces* : allow processes to have their own network / PIDs / users / hostname / mounts / and more !
    * *seccomp-bpf* (SEcure COMPuting) : for security, prevent dangerous system calls
    * *capabilities* : security: avoid giving root access +
    Capabilities allow to reduce the privileges of an active process
    * *overlay filesystems* : optimization to reduce disk space used by containers which are using the same image
--

== 

== Chronologie

TODO : ajouter ici un screenshot de la chronologie sur Timetoast

== Ressources

[.smallFont]
--
* Les *slides de la pr√©sentation* : https://github.com/Ardemius/history-of-containerization +
Vous trouverez √©galement dans ce repo GitHub toutes *mes notes* et *curation de contenu* sur le sujet, ainsi que le *code des slides* (qui utilisent Asciidoctor et la backend reveal.js)
--

=== !

[.smallFont]
--
* Le fantastique zine de *Julia Evans* "*How Containers Work!*". +
Les planches sont sur son Twitter https://twitter.com/b0rk[@b0rk], et vous pouvez √©galement acheter le *zine complet* sur son blog : https://jvns.ca/blog/2020/04/27/new-zine-how-containers-work/

* Le talk durant lequel *Solomon Hykes* a pr√©sent√© pour la 1ere fois Docker, "*Why we built Docker?*" : https://www.youtube.com/watch?v=3N3n9FzebAA +
Le talk a √©t√© donn√© √† la conf√©rence dotScale 2013, le 2013/06/07, juste apr√®s la 1ere publication de Docker.

* La s√©rie de 4 articles de Ian Lewis sur les *container runtimes* : https://www.ianlewis.org/en/container-runtimes-part-1-introduction-container-r +
Vous y trouverez une description compl√®te des diff√©rents √©l√©ments composant l'√©cosyst√®me des conteneurs (docker, dockerd, containerd, runc)
--

== Des questions ?

== Merci !










